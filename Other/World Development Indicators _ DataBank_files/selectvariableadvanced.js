function initCustomCtl(){$(".panel").on("click",".plusIcon",function(){var n=$(this).parent().attr("uniqueid"),t=$(this).parent().attr("formulaname"),i;$(this).parents(".panel").find(".customGroupElements li[uniqueid='"+n+"']").length<=0&&(i="<li uniqueid='"+n+"' "+(t!=null?"formulaname='"+t+"' ":"")+"><a href='javascript:void(0)' onclick='deleteItem(this)' ><span class='glyphicon glyphicon-remove-circle'><\/span><\/a>"+$(this).siblings(".value").text()+"<\/li>",$(this).parents(".panel").find(".customGroupElements").append(i),TrackFeature("Variables->"+getPanelHeading(this)+"->Add "+$(this).siblings(".value").text()+" to the custom group"))})}function addCustomGroup(n){var u;gbl_array_member_selected[n]==null&&(gbl_array_member_selected[n]={},GenarateAdobeDimensions(n));var f=gbl_array_member_selected[n],t=$("#txtCustomGroupName").val().trim(),o=$.map($("#customGroupCountries li"),function(n){return $(n).attr("uniqueid")}),s=$.map($("#customGroupCountries li"),function(n){return $(n).text()}),h=$("#txtCtryMetadata").val(),c=$("#chkCtryDisplay").prop("checked"),i={},r={},e=null;if(t==""){alert("Please enter group title.");return}(e=f["custom_"+t],e==null||confirm("Custom Group already exists. Do you want to overwrite?"))&&(i.displayname=t,i.custom=!0,r.unames=o,r.countries=s,r.metainfo=htmlEncode(h),r.displaydef=c,i.customdefinition=r,f["custom_"+t]=i,GenarateAdobeDimensions(n),u="#tbl_"+n,addCustomMember(n,u,i,!0,"editCustomGroup",!1,"Group"),getSelectedCount(n,u),clearCustomGroup(this),showSelectionsChanged(n),TrackFeature("Variables->"+getPanelHeading(this)+"->Add Custom group->"+t))}function clearCustomGroup(n){$("#txtCustomGroupName").val("");$("#customGroupCountries").html("");$("#txtCtryMetadata").val("");$("#chkCtryDisplay").prop({checked:!1});TrackFeature("Variables->"+getPanelHeading(n)+"->Clear Custom group")}function editCustomGroup(n,t){var f,r;gbl_array_member_selected[n]==null&&(gbl_array_member_selected[n]={},GenarateAdobeDimensions(n));var e=gbl_array_member_selected[n],u=e["custom_"+t],i=u.customdefinition;$("#txtCustomGroupName").val(u.displayname);$("#txtCtryMetadata").val(htmlDecode(i.metainfo));$("#chkCtryDisplay").prop({checked:i.displaydef});f=i.countries;r="";$.each(i.unames,function(n,t){r=r+"<li uniqueid='"+t+"'><a href='javascript:void(0)' onclick='deleteItem(this)' ><span class='glyphicon glyphicon-remove-circle'><\/span><\/a>"+f[n]+"<\/li>"});$("#customGroupCountries").html(r);$("#customGroup_"+n).parents("#zoomModalBody").hasClass("modal-body")&&$("#zoomModalBody").find(".openBtnModal").trigger("click");$("#customGroup_"+n+" div div.panel-heading a").hasClass("collapsed")&&$("#a_cg_"+n).trigger("click");TrackFeature("Variables->"+getPanelHeading(this)+"->Edit Custom group->"+t)}function setAggrRuleDetails(n,t){var u,r,i,f;$(n).hasClass("collapsed")&&gbl_array_data!=null&&(Object.keys(gbl_array_data).length<=0||(gbl_array_member_selected[t]==null&&(gbl_array_member_selected[t]={},GenarateAdobeDimensions(t)),u=gbl_array_member_selected[t],r=$.grep(Object.keys(gbl_array_data),function(n){return gbl_array_data[n].DT=="S"&&n==t+"_"+gbl_array_data[n].DH}),r.length<=0)||(i=gbl_array_data[r[0]],$("#tb-indicatorAggRule tbody").html(""),$.each(u,function(n,t){var i="<tr uniqueid="+n+"><td>"+t.displayname+"<\/td>";i+='<td><select class="w60 aggrmethod"><option value="NONE">None<\/option><option value="MEAN">Mean<\/option><option value="MEDIAN">Median<\/option><option value="MIN">Min<\/option><option value="SUM">Sum<\/option><\/select><\/td>';i+='<td><select class="w60 weighind"><option>None<\/option><\/select><\/td>';i+='<td><input type="text" class="form-control txt-percen"><\/td><\/tr>';$("#tb-indicatorAggRule tbody").append(i);t.AggregationRule!=null&&($("#tb-indicatorAggRule tr[uniqueid='"+n+"'] select.aggrmethod").val(t.AggregationRule.AggregationMethod),$("#tb-indicatorAggRule tr[uniqueid='"+n+"'] input.txt-percen").val(t.AggregationRule.AggregationPer))}),i.ARA!=null?($("#lblApplyAll").addClass("active"),$("#lblChooseForAll").removeClass("active"),$("#divApplyAll").show(),$("#divChooseForAll").hide(),$("#divApplyAll select.aggrmethod").val(i.ARA.AggregationMethod),$("#divApplyAll input.txt-percen").val(i.ARA.AggregationPer)):($("#lblApplyAll").removeClass("active"),$("#lblChooseForAll").addClass("active"),$("#divApplyAll").hide(),$("#divChooseForAll").show()),f=$(this).parents(".panel").find(".availableView").attr("data-type"),TrackFeature("Variables->"+getPanelHeading(this)+"->Define Aggreagation Rule")))}function clearCustomIndicator(){$("#customIndicators").html("");$("#txtCustomIndicatorName").val("");$("#txtIndMetadata").val("");$("#chkIndDisplay").prop({checked:!1});TrackFeature("Variables->Series->Create Custom Indicator->Clear")}function addIndicatorItem(n){var t="#customIndicators",i=$(n).text();switch(i){case"DEL":$(t).find("li:last").remove();break;case"PWR":$(t).append("<li>Pwr<\/li>");break;default:$(t).append("<li>"+i+"<\/li>")}}function addCustomIndicator(n){var u=$("#hdnCubeID").val(),r=$("#txtCustomIndicatorName").val().trim(),t,i;(gbl_array_member_selected[n]==null&&(gbl_array_member_selected[n]={},GenarateAdobeDimensions(n)),t=gbl_array_member_selected[n],i=t["custom_"+r],i==null||confirm("Custom Indicator already exists. Do you want to overwrite?"))&&(checkCustomIndicator(!0,n),TrackFeature("Variables->Series->Create Custom Indicator->Add"))}function addCustomIndicator_Valid(n,t,i,r,u){var o;gbl_array_member_selected[n]==null&&(gbl_array_member_selected[n]={},GenarateAdobeDimensions(n));var s=gbl_array_member_selected[n],h=$("#txtIndMetadata").val(),c=$("#chkIndDisplay").prop("checked"),e={},f={};e.displayname=t;e.custom=!0;f.formula=i;f.formulaname=u;f.formulatext=r;f.metainfo=htmlEncode(h);f.displaydef=c;e.customdefinition=f;s["custom_"+t]=e;GenarateAdobeDimensions(n);o="#tbl_"+n;addCustomMember(n,o,e,!0,"editCustomIndicator",!0,"Indicator");getSelectedCount(n,o);clearCustomIndicator();showSelectionsChanged(n)}function editCustomIndicator(n,t){var i,r,u,e;gbl_array_member_selected[n]==null&&(gbl_array_member_selected[n]={},GenarateAdobeDimensions(n));var s=gbl_array_member_selected[n],o=s["custom_"+t],f=o.customdefinition;$("#txtCustomIndicatorName").val(o.displayname);$("#txtIndMetadata").val(htmlDecode(f.metainfo));$("#chkIndDisplay").prop({checked:f.displaydef});i=f.formulatext;r=f.formula;r=r.split("`");r=r.filter(function(n){return n.trim()!==""});u=i.split("`");u.length<r.length&&(u=r.slice(),e=!1,$.each(r,function(n,t){if(!e)if(i=i.trim(),i.indexOf(t)==0)i=i.replace(t,"");else if(i.indexOf("[")==0&&i.indexOf("]")>0){var r=i.indexOf("]")+1;u[n]=i.substring(0,r);i=i.substring(r)}else e=!0}),e&&(u=r));$("#customIndicators").html("");$.each(r,function(n,t){var i="<li uniqueid='"+t+"'>"+u[n]+"<\/li>";$("#customIndicators").append(i)});$("#customGroup_"+n).parents("#zoomModalBody").hasClass("modal-body")&&$("#zoomModalBody").find(".openBtnModal").trigger("click");$("#customIndicator_"+n+" div div.panel-heading a").hasClass("collapsed")&&$("#a_cg_"+n).trigger("click")}function checkCustomIndicator(n,t){var f=$("#hdnCubeID").val(),u=$("#txtCustomIndicatorName").val(),i="",r="";if(u==""){alert("Please enter indicator title.");return}$("#report-loading").fadeIn();$("#customIndicators li").each(function(){i+="`";r!=""&&(r+="`");i+=$(this).attr("formulaname")!=null&&$(this).attr("formulaname")!=""?$(this).attr("formulaname"):$(this).attr("uniqueid")!=null&&$(this).attr("uniqueid")!=""?$(this).attr("uniqueid"):$(this).text();r+=$(this).text()});$.ajax({type:"POST",url:gbl_report_methods+"/ValidateCustomIndicator",async:!1,contentType:"application/json; charset=utf-8",data:"{cubeid:'"+f+"', controlid:'"+t+"', custommembername:'"+u+"', custommemberformula:'"+i+"'}",dataType:"json",success:function(f){f.d.formulaname==""?alert(f.d.errordata):n?addCustomIndicator_Valid(t,u,i,r,f.d.formulaname):alert("Validated sucessfully")},error:function(){window.location.href=gbl_error_file}});$("#report-loading").fadeOut();TrackFeature("Variables->Series->Create Custom Indicator->Validate")}$(document).ready(function(){initCustomCtl();var n;$("#aggRuleTxt").show();$("#seriesTable").addClass("aggregationRuleView");$("#txtCtryMetadata").off("blur");$("#txtCtryMetadata").on("blur",function(){n=$(this).parents(".panel").find(".availableView").attr("data-type");TrackFeature("Variables->"+getPanelHeading(this)+"->Create custom Group->Metadata(Optional)")});$("#chkCtryDisplay").off("click");$("#chkCtryDisplay").on("click",function(){n=$(this).parents(".panel").find(".availableView").attr("data-type");TrackFeature("Variables->"+getPanelHeading(this)+"->Create custom Group->Display "+getPanelHeading(this)+" List")});$(".aggrmethod").off("change");$(".aggrmethod").on("change",function(){n=$(this).parents(".panel").find(".availableView").attr("data-type");TrackFeature("Variables->"+getPanelHeading(this)+"->Define Aggregation Rule->Set rule for each indicator->Indicator rule")});$(".weighind").off("change");$(".weighind").on("change",function(){n=$(this).parents(".panel").find(".availableView").attr("data-type");TrackFeature("Variables->"+getPanelHeading(this)+"->Define Aggregation Rule->Set rule for each indicator->Weighted Indicator")});$(".txt-percen").off("blur");$(".txt-percen").on("blur",function(){n=$(this).parents(".panel").find(".availableView").attr("data-type");TrackFeature("Variables->"+getPanelHeading(this)+"->Define Aggregation Rule->Set rule for each indicator->Value %")});$("#txtTimeMetadata").off("blur");$("#txtTimeMetadata").on("blur",function(){n=$(this).parents(".panel").find(".availableView").attr("data-type");TrackFeature("Variables->"+getPanelHeading(this)+"->Create Time Function->Additional Options->Metadata(Optional)")});$("#txtIndMetadata").off("blur");$("#txtIndMetadata").on("blur",function(){n=$(this).parents(".panel").find(".availableView").attr("data-type");TrackFeature("Variables->"+getPanelHeading(this)+"->Create Custom Indicator->Additional Options->Metadata(Optional)")});$("#chkTimeDisplayDef").off("click");$("#chkTimeDisplayDef").on("click",function(){n=$(this).parents(".panel").find(".availableView").attr("data-type");TrackFeature("Variables->"+getPanelHeading(this)+"->Create Time Function->Additional Options->Display function definition")});$("#chkTimeHideTitle").off("click");$("#chkTimeHideTitle").on("click",function(){n=$(this).parents(".panel").find(".availableView").attr("data-type");TrackFeature("Variables->"+getPanelHeading(this)+"->Create Time Function->Additional Options->Hide title")});$("#chkTimeHideLabel").off("click");$("#chkTimeHideLabel").on("click",function(){n=$(this).parents(".panel").find(".availableView").attr("data-type");TrackFeature("Variables->"+getPanelHeading(this)+"->Create Time Function->Additional Options->Hide label")});$("#chkIndDisplay").off("click");$("#chkIndDisplay").on("click",function(){n=$(this).parents(".panel").find(".availableView").attr("data-type");TrackFeature("Variables->"+getPanelHeading(this)+"->Create Custom Indicator->Additional Options->Display Series List")})})